<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Home Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { 
            font-family: 'Arial', sans-serif; 
        }
        .dark-mode { background: linear-gradient(to bottom, #2b2b2b, #1a1a1a); color: #f4f4f4; }
        .dark-mode .card, .dark-mode .modal, .dark-mode .ha-sidebar { 
            background: rgba(50, 50, 50, 0.9); 
            color: #f4f4f4; 
            border-color: #555; 
        }
        .dark-mode .dashboard-header { 
            background-color: rgba(0, 51, 102, 0.8); 
        }
        .dark-mode .energy-theme .dashboard-header { 
            background-color: rgba(46, 125, 50, 0.8); 
        }
        .energy-theme { background: url('https://images.unsplash.com/photo-1448375240586-882707db888b?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80') no-repeat center center fixed; background-size: cover; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: none; }
        .modal { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            background: rgba(255, 255, 255, 0.9); 
            padding: 20px; border-radius: 10px; box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.3); display: none; z-index: 1050;
            transition: background-color 0.3s, color 0.3s; 
        }
        .small-modal { width: 300px; padding: 15px; }
        .notification-modal { width: 300px; max-height: 200px; overflow-y: auto; }
        .weather-icon { font-size: 1.5em; margin-right: 5px; }
        .dashboard-grid { display: flex; flex-wrap: wrap; justify-content: space-between; gap: 20px; padding: 20px; }
        .dashboard-header { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; background-color: rgba(0, 51, 102, 0.8); color: #fff; position: sticky; top: 0; z-index: 1000; }
        .energy-theme .dashboard-header { background-color: rgba(46, 125, 50, 0.8); }
        .header-info { text-align: right; }
        .header-info .time { font-size: 1.5em; }
        .header-info .location { font-size: 1.2em; }
        .header-info i { font-size: 1.5em; cursor: pointer; margin-left: 15px; }
        .device-item { display: flex; justify-content: space-between; align-items: center; margin: 5px 0; }
        .device-item button { background-color: #00b4b4; border: none; padding: 5px 10px; border-radius: 5px; color: white; }
        .energy-theme .device-item button { background-color: #4caf50; }
        .device-item button.off { background-color: #6c757d; }
        .thermostat-slider { width: 100%; margin: 10px 0; }
        #front-page { height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: rgba(0, 51, 102, 0.8); color: #fff; }
        .energy-theme #front-page { background-color: rgba(46, 125, 50, 0.8); }
        #front-page.hidden, #dashboard-page.hidden { display: none; }
        #login-icon { font-size: 1.5em; cursor: pointer; margin-top: 15px; }
        #front-location, #front-weather { margin-top: 10px; font-size: 1.2em; }
        .ha-sidebar { width: 250px; background-color: #003366; color: white; position: fixed; height: 100vh; padding: 20px; z-index: 1000; transition: width 0.3s; }
        .ha-sidebar.minimized { width: 60px; }
        .ha-sidebar.minimized .logo, .ha-sidebar.minimized .nav-link span, .ha-sidebar.minimized .btn span, .ha-sidebar.minimized .notification-icon span { display: none; }
        .ha-sidebar .logo { font-size: 1.5em; text-align: center; margin: 20px 0; }
        .ha-sidebar .nav-link { color: white; padding: 10px; display: flex; align-items: center; }
        .ha-sidebar .nav-link:hover { background: #004080; }
        .energy-theme .ha-sidebar .nav-link:hover { background: #388e3c; }
        .ha-sidebar .nav-link i { margin-right: 10px; }
        .ha-sidebar .minimize-icon { font-size: 1.5em; cursor: pointer; position: absolute; top: 10px; left: 10px; }
        .ha-sidebar .notification-icon { color: white; padding: 10px; display: flex; align-items: center; cursor: pointer; }
        .ha-sidebar .notification-icon:hover { background: #004080; }
        .energy-theme .ha-sidebar .notification-icon:hover { background: #388e3c; }
        .dashboard { margin-left: 270px; padding: 20px; transition: margin-left 0.3s; }
        .dashboard.minimized { margin-left: 60px; }
        .card { background: rgba(255, 255, 255, 0.9); border: 1px solid #ddd; border-radius: 10px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); flex: 1 1 calc(33.33% - 20px); min-width: 300px; margin-bottom: 20px; }
        .btn-primary { background-color: #00b4b4; border-color: #00b4b4; }
        .energy-theme .btn-primary { background-color: #4caf50; border-color: #4caf50; }
        .btn-danger { background-color: #d9534f; border-color: #d9534f; }
        canvas { max-height: 200px; width: 100%; }

        /* Media Queries */
        @media (max-width: 768px) {
            .ha-sidebar {
                width: 60px;
            }
            .ha-sidebar .logo, .ha-sidebar .nav-link span, .ha-sidebar .btn span, .ha-sidebar .notification-icon span {
                display: none;
            }
            .dashboard {
                margin-left: 60px;
            }
            .dashboard-grid {
                flex-direction: column;
            }
            .card {
                flex: 1 1 100%;
            }
        }

        @media (max-width: 576px) {
            .device-item {
                flex-direction: column;
                align-items: flex-start;
                margin: 10px 0;
            }
            .device-item span, .device-item button {
                margin: 5px 0;
            }
            body, .header-info .time, .header-info .location, #front-location, #front-weather {
                font-size: 0.9em;
            }
            .thermostat-slider, canvas {
                width: 100%;
            }
            .modal, .small-modal, .notification-modal {
                width: 90%;
            }
        }

        @media (min-width: 769px) {
            .ha-sidebar {
                width: 250px;
            }
            .dashboard {
                margin-left: 270px;
            }
        }
    </style>
</head>
<body onload="initFrontPage()">
    <div id="front-page">
        <h1 id="front-title">Smart Home Dashboard</h1>
        <div id="front-time" class="time">Loading...</div>
        <div id="front-location">Loading location...</div>
        <div id="front-weather">Loading weather...</div>
        <i id="login-icon" class="fas fa-user" onclick="showLoginModal()"></i>
    </div>

    <div id="login-modal" class="modal small-modal">
        <h3 id="login-title">Login</h3>
        <input type="text" id="login-username" class="form-control mb-2" placeholder="Username">
        <div class="password-container">
            <input type="password" id="login-password" class="form-control mb-2" placeholder="Password">
            <span class="eye-icon" onclick="togglePasswordVisibility()">üëÅÔ∏è</span>
        </div>
        <button class="btn btn-primary" onclick="loginUsername()">Login</button>
        <button class="btn btn-secondary" onclick="closeModals()">Close</button>
    </div>

    <div id="logout-modal" class="modal small-modal">
        <h3 id="logout-title">Logout?</h3>
        <button class="btn btn-danger" onclick="logout()">Yes</button>
        <button class="btn btn-secondary" onclick="closeModals()">No</button>
    </div>

    <div id="settings-modal" class="modal">
        <h2 id="settings-title">User Settings</h2>
        <div class="mb-3">
            <label for="username">Username:</label>
            <input type="text" id="username" class="form-control" placeholder="Enter your name">
        </div>
        <div class="mb-3">
            <label for="theme">Theme:</label>
            <select id="theme" class="form-control">
                <option value="smart-home">Smart Home Dashboard</option>
                <option value="energy">Energy Dashboard</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="temp-unit">Temperature Unit:</label>
            <select id="temp-unit" class="form-control">
                <option value="metric">Celsius (¬∞C)</option>
                <option value="imperial">Fahrenheit (¬∞F)</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="theme-color">Sidebar Color:</label>
            <select id="theme-color" class="form-control">
                <option value="#003366">Dark Teal (Default)</option>
                <option value="#0066cc">Blue</option>
                <option value="006600">Green</option>
                <option value="#cc0000">Red</option>
                <option value="#660066">Purple</option>
                <option value="#ff6600">Orange</option>
                <option value="#006666">Teal</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="language">Language:</label>
            <select id="language" class="form-control" onchange="applyLanguage()">
                <option value="en">English</option>
                <option value="es">Spanish</option>
                <option value="fr">French</option>
                <option value="de">German</option>
                <option value="ta">Tamil</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="number-format">Number Format:</label>
            <select id="number-format" class="form-control">
                <option value="en-US">1,234.56 (US)</option>
                <option value="de-DE">1.234,56 (Germany)</option>
                <option value="fr-FR">1 234,56 (France)</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="time-format">Time Format:</label>
            <select id="time-format" class="form-control">
                <option value="12">12-hour (e.g., 1:00 PM)</option>
                <option value="24">24-hour (e.g., 13:00)</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="date-format">Date Format:</label>
            <select id="date-format" class="form-control">
                <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                <option value="YYYY-MM-DD">YYYY-MM-DD</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="time-zone">Time Zone:</label>
            <select id="time-zone" class="form-control" onchange="applyTimeZone()">
                <option value="UTC">UTC</option>
                <option value="America/New_York">Eastern Time (US)</option>
                <option value="Europe/London">GMT (UK)</option>
                <option value="Asia/Tokyo">Japan Standard Time</option>
                <option value="Asia/Kolkata">Indian Standard Time (IST)</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="first-day">First Day of the Week:</label>
            <select id="first-day" class="form-control">
                <option value="Monday">Monday</option>
                <option value="Sunday">Sunday</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="background-image">Background Image (PNG/JPG):</label>
            <input type="file" id="background-image" class="form-control" accept=".png,.jpg,.jpeg">
        </div>
        <div class="mb-3">
            <label for="notification-sound">Notification Sound:</label>
            <input type="checkbox" id="notification-sound"> Enable
        </div>
        <div class="mb-3">
            <label for="dark-mode" data-i18n="darkMode">Dark Mode:</label>
            <input type="checkbox" id="dark-mode" onchange="toggleDarkMode()">
        </div>
        <button class="btn btn-primary" onclick="saveSettings()">Save</button>
        <button class="btn btn-secondary" onclick="closeModal()">Close</button>
    </div>

    <div id="notification-modal" class="modal notification-modal">
        <h3 id="notifications-title">Notifications</h3>
        <p id="notification-list">No notifications</p>
        <button class="btn btn-secondary mt-2" onclick="closeNotificationModal()">Close</button>
    </div>

    <div id="search-modal" class="modal small-modal">
        <h3 id="search-title">Search Items</h3>
        <input type="text" id="search-input" class="form-control mb-2" placeholder="Enter item name">
        <p id="search-results" class="mt-2">Enter an item name to search...</p>
        <button class="btn btn-primary" onclick="searchItems()">Search</button>
        <button class="btn btn-secondary" onclick="closeSearchModal()">Close</button>
    </div>

    <div id="edit-modal" class="modal small-modal">
        <h3 id="edit-title">Edit Items</h3>
        <div id="edit-items"></div>
        <div class="mb-2">
            <label for="edit-functions">Functions:</label>
            <select id="edit-functions" class="form-control">
                <option value="toggleDevice">toggleDevice</option>
                <option value="toggleLight">toggleLight</option>
                <option value="updateThermostat">updateThermostat</option>
                <option value="addTask">addTask</option>
                <option value="simulateSecurity">simulateSecurity</option>
            </select>
        </div>
        <button class="btn btn-primary mt-2" onclick="saveEditItems()">Save</button>
        <button class="btn btn-secondary mt-2" onclick="closeEditModal()">Close</button>
    </div>
        
    <div id="ac-modal" class="modal small-modal">
        <h3>AC Temperature</h3>
        <canvas id="ac-chart"></canvas>
        <label for="fan-swing">Fan Swing:</label>
        <select id="fan-swing" class="form-control" onchange="updateFanSwing(this.value)">
            <option value="1">Low</option>
            <option value="2">Medium</option>
            <option value="3">High</option>
        </select>
        <button class="btn btn-secondary mt-2" onclick="closeACModal()">Close</button>
    </div>

    <div id="lights-modal" class="modal small-modal">
        <h3>Lights Brightness</h3>
        <canvas id="lights-chart"></canvas>
        <button class="btn btn-secondary mt-2" onclick="closeLightsModal()">Close</button>
    </div>

    <div id="heater-modal" class="modal small-modal">
        <h3>Heater Temperature</h3>
        <canvas id="heater-chart"></canvas>
        <button class="btn btn-secondary mt-2" onclick="closeHeaterModal()">Close</button>
    </div>

    <div id="fan-modal" class="modal small-modal">
        <h3>Fan Speed</h3>
        <canvas id="fan-chart"></canvas>
        <button class="btn btn-secondary mt-2" onclick="closeFanModal()">Close</button>
    </div>

    <div id="task-timesup-modal" class="modal small-modal">
        <h3>Time's Up!</h3>
        <p id="task-timesup-message"></p>
        <button class="btn btn-secondary mt-2" onclick="closeTaskTimesUpModal()">Close</button>
    </div>

    <div id="settings-changed-modal" class="modal small-modal">
        <h3>Settings Updated</h3>
        <p>Settings have been changed successfully!</p>
        <button class="btn btn-secondary mt-2" onclick="closeSettingsChangedModal()">Close</button>
    </div>

    <div id="modal-overlay" class="modal-overlay" onclick="closeModals()"></div>

    <div id="dashboard-page" class="container-fluid dashboard-container hidden">
        <nav class="ha-sidebar" id="sidebar">
            <div class="minimize-icon" id="minimize-sidebar"><i class="fas fa-bars"></i></div>
            <div class="logo" id="sidebar-logo">Smart Home Assistant</div>
            <a href="#" class="nav-link" onclick="showDashboard(); return false;"><i class="fas fa-home"></i><span id="overview-link">Overview</span></a>
            <a href="#" class="nav-link" onclick="openEnergyPage()"><i class="fas fa-chart-bar"></i><span id="energy-link">Energy</span></a>
            <a href="#" class="nav-link" onclick="showSettings()"><i class="fas fa-cog"></i><span id="settings-link">Settings</span></a>
            <div class="notification-icon" onclick="toggleNotifications()"><i class="fas fa-bell"></i><span id="notifications-link">Notifications</span></div>
            <button class="btn btn-danger w-100 mt-3" onclick="showLogoutModal()"><i class="fas fa-sign-out-alt"></i><span id="logout-link"> Logout</span></button>
        </nav>

        <div class="dashboard" id="dashboard-content">
            <div class="dashboard-header">
                <h1 class="h3 mb-0" id="dashboard-title">Smart Home Dashboard</h1>
                <div class="header-info">
                    <div class="location" id="header-location">Loading...</div>
                    <div class="time" id="header-time">Loading...</div>
                    <i class="fas fa-search" onclick="showSearchModal()"></i>
                    <i class="fas fa-edit" onclick="showEditModal()"></i>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="card" id="weather-info">
                    <h2 id="weather-title">Current Weather</h2>
                    <p id="current-weather">Loading weather data...</p>
                </div>

                <div class="card" id="forecast-section">
                    <h2 id="forecast-title">7-Day Weather Forecast</h2>
                    <div id="forecast-info" class="forecast-container"></div>
                </div>

                <div class="card" id="devices-section">
                    <h2 id="devices-title">Device Control</h2>
                    <div class="device-item">
                        <span>AC</span>
                        <button id="ac-btn" class="btn off" onclick="toggleDevice('AC')">Off</button>
                    </div>
                    <div class="device-item">
                        <span>Lights</span>
                        <button id="lights-btn" class="btn off" onclick="toggleDevice('Lights')">Off</button>
                    </div>
                    <div class="device-item">
                        <span>TV</span>
                        <button id="tv-btn" class="btn off" onclick="toggleDevice('TV')">Off</button>
                    </div>
                    <div class="device-item">
                        <span>Heater</span>
                        <button id="heater-btn" class="btn off" onclick="toggleDevice('Heater')">Off</button>
                    </div>
                    <div class="device-item">
                        <span>Fan</span>
                        <button id="fan-btn" class="btn off" onclick="toggleDevice('Fan')">Off</button>
                    </div>
                    <div class="mt-3">
                        <h3 id="thermostat-title">Thermostat</h3>
                        <p>Current Temp: <span id="thermostat-temp">22</span>¬∞C</p>
                        <input type="range" id="thermostat-slider" class="thermostat-slider" min="16" max="30" value="22" oninput="updateThermostat(this.value)">
                    </div>
                </div>

                <div class="card" id="lighting-section">
                    <h2 id="lighting-title">Home Lighting</h2>
                    <div class="device-item">
                        <span>Living Room</span>
                        <button id="living-room-btn" class="btn off" onclick="toggleLight('Living Room')">Off</button>
                    </div>
                    <div class="device-item">
                        <span>Master Bedroom</span>
                        <button id="master-bedroom-btn" class="btn off" onclick="toggleLight('Master Bedroom')">Off</button>
                    </div>
                    <div class="device-item">
                        <span>Kitchen</span>
                        <button id="kitchen-btn" class="btn off" onclick="toggleLight('Kitchen')">Off</button>
                    </div>
                    <div class="device-item">
                        <span>Office</span>
                        <button id="office-btn" class="btn off" onclick="toggleLight('Office')">Off</button>
                    </div>
                </div>

                <div class="card" id="energy-section">
                    <h2 id="energy-title">Energy Consumption</h2>
                    <ul>
                        <li>AC: <span id="ac-usage">1.5 kWh</span></li>
                        <li>Lights: <span id="lights-usage">0.2 kWh</span></li>
                        <li>TV: <span id="tv-usage">0.8 kWh</span></li>
                        <li>Heater: <span id="heater-usage">2.0 kWh</span></li>
                        <li>Fan: <span id="fan-usage">0.5 kWh</span></li>
                    </ul>
                </div>

                <div class="card" id="tasks-section">
                    <h2 id="tasks-title">Task Reminder</h2>
                    <div class="input-group mb-2">
                        <input type="text" id="task-name" class="form-control" placeholder="Task Name">
                        <input type="time" id="task-time" class="form-control">
                        <button class="btn btn-primary" onclick="addTask()">Add</button>
                    </div>
                    <ul id="task-list"></ul>
                </div>

                <div class="card" id="security-section">
                    <h2 id="security-title">Security</h2>
                    <ul>
                        <li>Motion Sensor: <span id="motion-status">Inactive</span></li>
                        <li>Front Door: <span id="front-door-status">Closed</span></li>
                        <li>Back Door: <span id="back-door-status">Closed</span></li>
                        <li>Alerts: <span id="security-alerts">No recent threats</span></li>
                    </ul>
                    <button class="btn btn-warning" onclick="simulateSecurity()">Simulate Alert</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_KEY = "847fc7f7109e3dac6611d33c7e8aa6b5";

        let energyUsage = { "AC": 1.5, "Lights": 0.2, "TV": 0.8, "Heater": 2.0, "Fan": 0.5 };
        let deviceStatus = { "AC": false, "Lights": false, "TV": false, "Heater": false, "Fan": false };
        let lightStatus = { "Living Room": false, "Master Bedroom": false, "Kitchen": false, "Office": false };
        let doorStatus = { "Front Door": false, "Back Door": false };
        let thermostatTemp = 22;
        let isLoggedIn = false;
        let notifications = [];
        let tempUnit = "metric";
        let language = "en";
        let numberFormat = "en-US";
        let timeFormat = "12";
        let dateFormat = "MM/DD/YYYY";
        let timeZone = "Asia/Kolkata";
        let firstDay = "Monday";
        let systemCheckShown = false;

        const notificationSound = new Audio('https://www.soundjay.com/buttons/beep-01a.mp3');

        function initFrontPage() {
            updateTime();
            setInterval(updateTime, 1000);
            fetchFrontWeather();
            fetchFrontLocation();
            loadCredentials();
            loadSettings();
            adjustLayoutForScreenSize();
            if (localStorage.getItem("showDashboard") === "true" && localStorage.getItem("username") && localStorage.getItem("password")) {
                isLoggedIn = true;
                document.getElementById("front-page").classList.add("hidden");
                document.getElementById("dashboard-page").classList.remove("hidden");
                initDashboard();
                localStorage.removeItem("showDashboard");
            }
        }

        function adjustLayoutForScreenSize() {
            const sidebar = document.getElementById("sidebar");
            const dashboard = document.getElementById("dashboard-content");
            if (window.innerWidth <= 768) {
                sidebar.classList.add("minimized");
                dashboard.classList.add("minimized");
            } else {
                sidebar.classList.remove("minimized");
                dashboard.classList.remove("minimized");
            }
        }

        window.addEventListener("load", adjustLayoutForScreenSize);
        window.addEventListener("resize", adjustLayoutForScreenSize);

        function initDashboard() {
            fetchWeatherAndForecast();
            updateLocation();
            updateEnergyUsage();
            updateDeviceButtons();
            updateLightButtons();
            updateDoorStatus();
            updateNotifications();
            loadSettings();
        }

        function showDashboard() {
            if (!isLoggedIn) return showLoginModal();
            document.getElementById("dashboard-page").classList.remove("hidden");
            document.querySelectorAll('.dashboard-grid .card').forEach(card => {
                card.style.display = 'none';
            });
            document.getElementById('weather-info').style.display = 'block';
            document.getElementById('forecast-section').style.display = 'block';
            fetchWeatherAndForecast();
        }

        function saveSettings() {
            const username = document.getElementById("username").value;
            const theme = document.getElementById("theme").value;
            const tempUnitSetting = document.getElementById("temp-unit").value;
            const themeColor = document.getElementById("theme-color").value;
            const languageSetting = document.getElementById("language").value;
            const numberFormatSetting = document.getElementById("number-format").value;
            const timeFormatSetting = document.getElementById("time-format").value;
            const dateFormatSetting = document.getElementById("date-format").value;
            const timeZoneSetting = document.getElementById("time-zone").value;
            const firstDaySetting = document.getElementById("first-day").value;
            const notificationSound = document.getElementById("notification-sound").checked;
            const darkMode = document.getElementById("dark-mode").checked;
            const backgroundImage = document.getElementById("background-image").files[0];

            if (username) {
                localStorage.setItem("username", username);
                localStorage.setItem("theme", theme);
                localStorage.setItem("tempUnit", tempUnitSetting);
                localStorage.setItem("themeColor", themeColor);
                localStorage.setItem("language", languageSetting);
                localStorage.setItem("numberFormat", numberFormatSetting);
                localStorage.setItem("timeFormat", timeFormatSetting);
                localStorage.setItem("dateFormat", dateFormatSetting);
                localStorage.setItem("timeZone", timeZoneSetting);
                localStorage.setItem("firstDay", firstDaySetting);
                localStorage.setItem("notificationSound", notificationSound);
                localStorage.setItem("darkMode", darkMode);
                tempUnit = tempUnitSetting;
                language = languageSetting;
                numberFormat = numberFormatSetting;
                timeFormat = timeFormatSetting;
                dateFormat = dateFormatSetting;
                timeZone = timeZoneSetting;
                firstDay = firstDaySetting;

                if (backgroundImage) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        localStorage.setItem("backgroundImage", e.target.result);
                        document.body.style.background = `url(${e.target.result}) no-repeat center center fixed`;
                        document.body.style.backgroundSize = "cover";
                        document.querySelectorAll(".modal").forEach(modal => {
                            modal.style.background = `rgba(255, 255, 255, 0.9) url(${e.target.result}) no-repeat center center fixed`;
                            modal.style.backgroundSize = "cover";
                        });
                    };
                    reader.readAsDataURL(backgroundImage);
                }

                applyThemeSettings();
                applyLanguage();
                applyTimeZone();
                updateEnergyUsage();
                fetchWeatherAndForecast();
                closeModal();
                document.getElementById("settings-changed-modal").style.display = "block";
                document.getElementById("modal-overlay").style.display = "block";
            } else {
                alert("Please enter a username");
            }
        }

        function showFullDashboard() {
            document.getElementById("dashboard-page").classList.remove("hidden");
            document.querySelectorAll('.dashboard-grid .card').forEach(card => {
                card.style.display = 'block';
            });
            initDashboard();
        }

        function loginUsername() {
            const username = document.getElementById("login-username").value;
            const password = document.getElementById("login-password").value;
            if (username && password) {
                localStorage.setItem("username", username);
                localStorage.setItem("password", password);
                isLoggedIn = true;
                document.getElementById("front-page").classList.add("hidden");
                document.getElementById("dashboard-page").classList.remove("hidden");
                closeModals();
                showFullDashboard();
            } else {
                alert("Please enter valid credentials.");
            }
        }

        function fetchFrontWeather() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=${tempUnit}&appid=${API_KEY}&lang=${language}`)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                            return response.json();
                        })
                        .then(data => {
                            const temp = Math.round(data.main.temp);
                            const condition = data.weather[0].main.toLowerCase();
                            const humidity = data.main.humidity;
                            const windSpeed = data.wind.speed;
                            const icon = getWeatherIcon(condition);
                            document.getElementById("front-weather").innerHTML = `
                                <i class="${icon} weather-icon"></i> 
                                ${temp}${tempUnit === "metric" ? "¬∞C" : "¬∞F"} - ${data.weather[0].description}<br>
                                Humidity: ${humidity}% | Wind: ${windSpeed} ${tempUnit === "metric" ? "m/s" : "mph"}
                            `;
                        })
                        .catch(error => {
                            console.error('Error fetching front weather:', error);
                            document.getElementById("front-weather").textContent = "Unable to fetch weather. Check API key.";
                        });
                }, error => {
                    document.getElementById("front-weather").textContent = "Geolocation permission denied.";
                });
            } else {
                document.getElementById("front-weather").textContent = "Geolocation not supported.";
            }
        }

        function fetchFrontLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async position => {
                    const { latitude, longitude } = position.coords;
                    const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`);
                    const data = await response.json();
                    document.getElementById("front-location").textContent = `${data.address.city || data.address.town || ""}, ${data.address.country || ""}`;
                }, error => {
                    document.getElementById("front-location").textContent = "Geolocation permission denied.";
                });
            } else {
                document.getElementById("front-location").textContent = "Geolocation not supported.";
            }
        }

        function fetchWeatherAndForecast() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;

                    fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=${tempUnit}&appid=${API_KEY}&lang=${language}`)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                            return response.json();
                        })
                        .then(data => {
                            const temp = Math.round(data.main.temp);
                            const feelsLike = Math.round(data.main.feels_like);
                            const condition = data.weather[0].main.toLowerCase();
                            const humidity = data.main.humidity;
                            const windSpeed = data.wind.speed;
                            const icon = getWeatherIcon(condition);
                            document.getElementById("current-weather").innerHTML = `
                                <p>Location: ${data.name}</p>
                                <p><i class="${icon} weather-icon"></i> ${temp}${tempUnit === "metric" ? "¬∞C" : "¬∞F"} (Feels like: ${feelsLike}${tempUnit === "metric" ? "¬∞C" : "¬∞F"})</p>
                                <p>${data.weather[0].description}</p>
                                <p>Humidity: ${humidity}% | Wind: ${windSpeed} ${tempUnit === "metric" ? "m/s" : "mph"}</p>
                            `;
                        })
                        .catch(error => {
                            console.error('Error fetching current weather:', error);
                            document.getElementById("current-weather").textContent = "Unable to fetch current weather. Check API key.";
                        });

                    fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=${tempUnit}&appid=${API_KEY}&lang=${language}`)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                            return response.json();
                        })
                        .then(data => {
                            const forecastContainer = document.getElementById("forecast-info");
                            let forecastHtml = '';
                            const dailyData = data.list.filter(item => item.dt_txt.includes("12:00:00")).slice(0, 7);

                            dailyData.forEach((day) => {
                                const date = new Date(day.dt * 1000);
                                const dayName = date.toLocaleDateString(language, { 
                                    weekday: 'short', 
                                    month: 'short', 
                                    day: 'numeric' 
                                });
                                const tempMax = Math.round(day.main.temp_max);
                                const tempMin = Math.round(day.main.temp_min);
                                const condition = day.weather[0].main.toLowerCase();
                                const icon = getWeatherIcon(condition);

                                forecastHtml += `
                                    <div>
                                        <p>${dayName}</p>
                                        <p><i class="${icon} weather-icon"></i> ${tempMax}/${tempMin}${tempUnit === "metric" ? "¬∞C" : "¬∞F"}</p>
                                        <p>${day.weather[0].description}</p>
                                    </div>
                                `;
                            });

                            forecastContainer.innerHTML = forecastHtml || "No forecast data available.";
                        })
                        .catch(error => {
                            console.error('Error fetching forecast:', error);
                            document.getElementById("forecast-info").textContent = "Unable to fetch forecast. Check API key.";
                        });
                }, error => {
                    document.getElementById("current-weather").textContent = "Geolocation permission denied.";
                    document.getElementById("forecast-info").textContent = "Geolocation permission denied.";
                });
            } else {
                document.getElementById("current-weather").textContent = "Geolocation not supported.";
                document.getElementById("forecast-info").textContent = "Geolocation not supported.";
            }
        }

        function getWeatherIcon(condition) {
            return { 
                "clear": "fas fa-sun", 
                "clouds": "fas fa-cloud", 
                "rain": "fas fa-cloud-rain", 
                "thunderstorm": "fas fa-bolt", 
                "drizzle": "fas fa-cloud-showers-heavy", 
                "snow": "fas fa-snowflake",
                "mist": "fas fa-smog",
                "fog": "fas fa-smog",
                "haze": "fas fa-smog"
            }[condition] || "fas fa-sun";
        }

        function updateTime() {
            const date = new Date();
            const options = {
                hour12: timeFormat === "12",
                hour: 'numeric',
                minute: '2-digit',
                timeZone: timeZone
            };
            const timeStr = date.toLocaleTimeString(language, options);
            document.getElementById("front-time").textContent = timeStr;
            document.getElementById("header-time").textContent = timeStr;
            if (isLoggedIn) checkScheduledTasks(date);
        }

        function updateLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async position => {
                    const { latitude, longitude } = position.coords;
                    const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`);
                    const data = await response.json();
                    document.getElementById("header-location").textContent = `${data.address.city || data.address.town || ""}, ${data.address.country || ""}`;
                });
            }
        }

        function toggleDevice(device) {
            if (!isLoggedIn) return showLoginModal();
            deviceStatus[device] = !deviceStatus[device];
            updateDeviceButtons();
            updateEnergyUsage();
            if (deviceStatus[device]) {
                if (device === "AC") showACModal();
                else if (device === "Lights") showLightsModal();
                else if (device === "Heater") showHeaterModal();
                else if (device === "Fan") showFanModal();
            }
        }

        function toggleLight(light) {
            if (!isLoggedIn) return showLoginModal();
            lightStatus[light] = !lightStatus[light];
            updateLightButtons();
            updateEnergyUsage();
        }

        function toggleDoor(door) {
            if (!isLoggedIn) return showLoginModal();
            doorStatus[door] = !doorStatus[door];
            updateDoorStatus();
            if (doorStatus[door]) addNotification(`${door} opened at ${new Date().toLocaleTimeString(language)}`);
        }

        function updateDeviceButtons() {
            Object.keys(deviceStatus).forEach(device => {
                const btn = document.getElementById(`${device.toLowerCase()}-btn`);
                btn.textContent = deviceStatus[device] ? "On" : "Off";
                btn.className = `btn ${deviceStatus[device] ? 'btn-primary' : 'btn-secondary off'}`;
            });
        }

        function updateLightButtons() {
            Object.keys(lightStatus).forEach(light => {
                const btn = document.getElementById(`${light.toLowerCase().replace(' ', '-')}-btn`);
                btn.textContent = lightStatus[light] ? "On" : "Off";
                btn.className = `btn ${lightStatus[light] ? 'btn-primary' : 'btn-secondary off'}`;
            });
        }

        function updateDoorStatus() {
            document.getElementById("front-door-status").textContent = doorStatus["Front Door"] ? "Open" : "Closed";
            document.getElementById("back-door-status").textContent = doorStatus["Back Door"] ? "Open" : "Closed";
        }

        function updateThermostat(value) {
            if (!isLoggedIn) return showLoginModal();
            thermostatTemp = parseInt(value);
            document.getElementById("thermostat-temp").textContent = thermostatTemp;
            updateEnergyUsage();
        }

        function updateEnergyUsage() {
            let totalLightsOn = Object.values(lightStatus).filter(status => status).length;
            energyUsage["Lights"] = totalLightsOn * 0.1;
            energyUsage["AC"] = deviceStatus["AC"] ? 1.5 : 0;
            energyUsage["TV"] = deviceStatus["TV"] ? 0.8 : 0;
            energyUsage["Heater"] = deviceStatus["Heater"] ? 2.0 : 0;
            energyUsage["Fan"] = deviceStatus["Fan"] ? 0.5 : 0;
            Object.keys(energyUsage).forEach(device => {
                document.getElementById(`${device.toLowerCase()}-usage`).textContent = `${energyUsage[device].toLocaleString(numberFormat)} kWh`;
            });
            localStorage.setItem("energyUsage", JSON.stringify(energyUsage));
        }

        function addTask() {
            if (!isLoggedIn) return showLoginModal();
            const taskName = document.getElementById("task-name").value;
            const taskTime = document.getElementById("task-time").value;
            if (taskName && taskTime) {
                const taskList = document.getElementById("task-list");
                const li = document.createElement("li");
                li.innerHTML = `${taskName} at ${taskTime} <button class="btn btn-danger btn-sm" onclick="deleteTask(this)">Delete</button>`;
                li.dataset.time = taskTime;
                taskList.appendChild(li);
                document.getElementById("task-name").value = "";
                document.getElementById("task-time").value = "";
                addNotification(`Task "${taskName}" scheduled for ${taskTime}`);
            }
        }

        function deleteTask(button) {
            if (!isLoggedIn) return showLoginModal();
            button.parentElement.remove();
        }

        function checkScheduledTasks(date) {
            const tasks = document.getElementById("task-list").children;
            const currentTime = `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
            Array.from(tasks).forEach(task => {
                if (task.dataset.time === currentTime) {
                    showTaskTimesUpModal(task.textContent.split(' at ')[0]);
                    addNotification(`Task "${task.textContent.split(' at ')[0]}" triggered at ${date.toLocaleTimeString(language)}`);
                    task.remove();
                }
            });
        }

        function showTaskTimesUpModal(taskName) {
            const modal = document.getElementById("task-timesup-modal");
            const overlay = document.getElementById("modal-overlay");
            document.getElementById("task-timesup-message").textContent = `Task "${taskName}" is due now!`;
            modal.style.display = "block";
            overlay.style.display = "block";
            if (localStorage.getItem("notificationSound") !== "false") {
                notificationSound.play();
            }
        }

        function closeTaskTimesUpModal() {
            document.getElementById("task-timesup-modal").style.display = "none";
            document.getElementById("modal-overlay").style.display = "none";
        }

        function simulateSecurity() {
            if (!isLoggedIn) return showLoginModal();
            const motionStatus = document.getElementById("motion-status");
            const alerts = document.getElementById("security-alerts");
            const motionActive = Math.random() > 0.8;
            const frontDoorOpen = Math.random() > 0.9;
            const backDoorOpen = Math.random() > 0.9;
            motionStatus.textContent = motionActive ? "Active" : "Inactive";
            doorStatus["Front Door"] = frontDoorOpen;
            doorStatus["Back Door"] = backDoorOpen;
            updateDoorStatus();
            if (motionActive || frontDoorOpen || backDoorOpen) {
                const msg = `${motionActive ? "Motion detected" : ""}${motionActive && (frontDoorOpen || backDoorOpen) ? " and " : ""}${frontDoorOpen ? "Front Door opened" : ""}${frontDoorOpen && backDoorOpen ? " and " : ""}${backDoorOpen ? "Back Door opened" : ""} at ${new Date().toLocaleTimeString(language)}`;
                alerts.textContent = msg;
                addNotification(msg);
            } else {
                alerts.textContent = "No recent threats";
            }
        }

        function showACModal() {
            const modal = document.getElementById("ac-modal");
            const overlay = document.getElementById("modal-overlay");
            modal.style.display = "block";
            overlay.style.display = "block";
            new Chart(document.getElementById("ac-chart"), {
                type: 'line',
                data: {
                    labels: ["0s", "5s", "10s", "15s"],
                    datasets: [{ label: 'Temp (¬∞C)', data: [22, 21, 20, 19], borderColor: '#00b4b4', fill: false }]
                },
                options: { responsive: true, scales: { y: { beginAtZero: false, min: 16, max: 30 } } }
            });
        }

        function updateFanSwing(value) {
            console.log(`Fan Swing set to ${value}`);
        }

        function closeACModal() {
            document.getElementById("ac-modal").style.display = "none";
            document.getElementById("modal-overlay").style.display = "none";
        }

        function showLightsModal() {
            const modal = document.getElementById("lights-modal");
            const overlay = document.getElementById("modal-overlay");
            modal.style.display = "block";
            overlay.style.display = "block";
            new Chart(document.getElementById("lights-chart"), {
                type: 'bar',
                data: {
                    labels: ["Bright", "Dull"],
                    datasets: [{ label: 'Brightness', data: [100, 50], backgroundColor: ['#00b4b4', '#6c757d'] }]
                },
                options: { responsive: true, scales: { y: { beginAtZero: true, max: 100 } } }
            });
        }

        function closeLightsModal() {
            document.getElementById("lights-modal").style.display = "none";
            document.getElementById("modal-overlay").style.display = "none";
        }

        function showHeaterModal() {
            const modal = document.getElementById("heater-modal");
            const overlay = document.getElementById("modal-overlay");
            modal.style.display = "block";
            overlay.style.display = "block";
            new Chart(document.getElementById("heater-chart"), {
                type: 'line',
                data: {
                    labels: ["0s", "5s", "10s", "15s"],
                    datasets: [{ label: 'Temp (¬∞C)', data: [20, 25, 30, 35], borderColor: '#d9534f', fill: false }]
                },
                options: { responsive: true, scales: { y: { beginAtZero: false, min: 15, max: 40 } } }
            });
        }

        function closeHeaterModal() {
            document.getElementById("heater-modal").style.display = "none";
            document.getElementById("modal-overlay").style.display = "none";
        }

        function showFanModal() {
            const modal = document.getElementById("fan-modal");
            const overlay = document.getElementById("modal-overlay");
            modal.style.display = "block";
            overlay.style.display = "block";
            new Chart(document.getElementById("fan-chart"), {
                type: 'bar',
                data: {
                    labels: ["Low", "Medium", "High"],
                    datasets: [{ label: 'Speed', data: [30, 60, 100], backgroundColor: '#00b4b4' }]
                },
                options: { responsive: true, scales: { y: { beginAtZero: true, max: 100 } } }
            });
        }

        function closeFanModal() {
            document.getElementById("fan-modal").style.display = "none";
            document.getElementById("modal-overlay").style.display = "none";
        }

        function addNotification(message) {
            notifications.unshift(message);
            if (notifications.length > 5) notifications.pop();
            updateNotifications();
        }

        function updateNotifications() {
            const notificationList = document.getElementById("notification-list");
            notificationList.innerHTML = notifications.length > 0 ? notifications.join("<br>") : "No notifications";
        }

        function toggleNotifications() {
            const modal = document.getElementById("notification-modal");
            const overlay = document.getElementById("modal-overlay");
            if (modal.style.display !== "block") {
                if (!systemCheckShown) {
                    addNotification("System check completed at " + new Date().toLocaleTimeString(language));
                    systemCheckShown = true;
                }
                modal.style.display = "block";
                overlay.style.display = "block";
            } else {
                modal.style.display = "none";
                overlay.style.display = "none";
            }
        }

        function closeNotificationModal() {
            document.getElementById("notification-modal").style.display = "none";
            document.getElementById("modal-overlay").style.display = "none";
        }

        function showSearchModal() {
            document.getElementById("search-modal").style.display = "block";
            document.getElementById("modal-overlay").style.display = "block";
            document.getElementById("search-input").value = "";
            document.getElementById("search-results").textContent = "Enter an item name to search...";
        }

        function closeSearchModal() {
            document.getElementById("search-modal").style.display = "none";
            document.getElementById("modal-overlay").style.display = "none";
        }

        function searchItems() {
            const query = document.getElementById("search-input").value.toLowerCase();
            const items = new Set([
                ...Object.keys(deviceStatus),
                ...Object.keys(lightStatus),
                ...Array.from(document.getElementById("task-list").children).map(li => li.textContent.split(' at ')[0]),
                "Motion Sensor", "Front Door", "Back Door", "Alerts"
            ]);
            const results = Array.from(items).filter(item => item.toLowerCase().includes(query));
            document.getElementById("search-results").textContent = results.length > 0 ? results.join(", ") : "No items found.";
        }

        function showEditModal() {
            const editItemsDiv = document.getElementById("edit-items");
            editItemsDiv.innerHTML = "";
            Object.keys(deviceStatus).forEach(device => {
                editItemsDiv.innerHTML += `<div class="mb-2"><label>${device}:</label><input type="text" id="edit-${device.toLowerCase()}" class="form-control" value="${device}"></div>`;
            });
            Object.keys(lightStatus).forEach(light => {
                editItemsDiv.innerHTML += `<div class="mb-2"><label>${light}:</label><input type="text" id="edit-${light.toLowerCase().replace(' ', '-')}" class="form-control" value="${light}"></div>`;
            });
            Array.from(document.getElementById("task-list").children).forEach((task, index) => {
                const taskName = task.textContent.split(' at ')[0];
                editItemsDiv.innerHTML += `<div class="mb-2"><label>Task ${index + 1}:</label><input type="text" id="edit-task-${index}" class="form-control" value="${taskName}"></div>`;
            });
            ["Motion Sensor", "Front Door", "Back Door", "Alerts"].forEach(item => {
                editItemsDiv.innerHTML += `<div class="mb-2"><label>${item}:</label><input type="text" id="edit-${item.toLowerCase().replace(' ', '-')}" class="form-control" value="${item}"></div>`;
            });
            document.getElementById("edit-modal").style.display = "block";
            document.getElementById("modal-overlay").style.display = "block";
        }

        function saveEditItems() {
            Object.keys(deviceStatus).forEach(device => {
                const newName = document.getElementById(`edit-${device.toLowerCase()}`).value;
                if (newName && newName !== device) {
                    deviceStatus[newName] = deviceStatus[device];
                    delete deviceStatus[device];
                    document.querySelector(`#${device.toLowerCase()}-btn`).parentElement.querySelector("span").textContent = newName;
                }
            });
            Object.keys(lightStatus).forEach(light => {
                const newName = document.getElementById(`edit-${light.toLowerCase().replace(' ', '-')}`).value;
                if (newName && newName !== light) {
                    lightStatus[newName] = lightStatus[light];
                    delete lightStatus[light];
                    document.querySelector(`#${light.toLowerCase().replace(' ', '-')}-btn`).parentElement.querySelector("span").textContent = newName;
                }
            });
            Array.from(document.getElementById("task-list").children).forEach((task, index) => {
                const newName = document.getElementById(`edit-task-${index}`).value;
                const taskTime = task.dataset.time;
                if (newName) {
                    task.innerHTML = `${newName} at ${taskTime} <button class="btn btn-danger btn-sm" onclick="deleteTask(this)">Delete</button>`;
                }
            });
            ["Motion Sensor", "Front Door", "Back Door", "Alerts"].forEach(item => {
                const newName = document.getElementById(`edit-${item.toLowerCase().replace(' ', '-')}`).value;
                if (newName && newName !== item) {
                    if (item === "Front Door" || item === "Back Door") {
                        doorStatus[newName] = doorStatus[item];
                        delete doorStatus[item];
                        document.getElementById(`${item.toLowerCase().replace(' ', '-')}-status`).parentElement.querySelector("li").innerHTML = `${newName}: <span id="${newName.toLowerCase().replace(' ', '-')}-status">${doorStatus[newName] ? "Open" : "Closed"}</span>`;
                    } else if (item === "Motion Sensor") {
                        document.getElementById("motion-status").parentElement.querySelector("li").innerHTML = `${newName}: <span id="motion-status">${document.getElementById("motion-status").textContent}</span>`;
                    } else if (item === "Alerts") {
                        document.getElementById("security-alerts").parentElement.querySelector("li").innerHTML = `${newName}: <span id="security-alerts">${document.getElementById("security-alerts").textContent}</span>`;
                    }
                }
            });
            const selectedFunction = document.getElementById("edit-functions").value;
            if (selectedFunction) {
                alert(`Function ${selectedFunction} selected for editing (placeholder functionality)`);
            }
            updateDeviceButtons();
            updateLightButtons();
            updateDoorStatus();
            closeEditModal();
        }

        function closeEditModal() {
            document.getElementById("edit-modal").style.display = "none";
            document.getElementById("modal-overlay").style.display = "none";
        }

        function openEnergyPage() {
            if (!isLoggedIn) return showLoginModal();
            window.open("energy.html", "_blank");
        }

        function toggleSidebar() {
            const sidebar = document.getElementById("sidebar");
            const content = document.getElementById("dashboard-content");
            sidebar.classList.toggle("minimized");
            content.classList.toggle("minimized");
            if (window.innerWidth > 768) {
                sidebar.style.width = sidebar.classList.contains("minimized") ? "60px" : "250px";
                content.style.marginLeft = sidebar.classList.contains("minimized") ? "60px" : "270px";
            }
        }

        function toggleDarkMode() {
            document.body.classList.toggle("dark-mode");
        }

        document.addEventListener("DOMContentLoaded", () => {
            document.getElementById("minimize-sidebar").addEventListener("click", toggleSidebar);
            document.getElementById("tasks-title").textContent = "Task Reminder";
            document.getElementById("security-title").textContent = "Security";
        });

        function showLoginModal() {
            document.getElementById("login-modal").style.display = "block";
            document.getElementById("modal-overlay").style.display = "block";
            loadCredentials(); 
        }

        function closeModals() {
            document.getElementById("login-modal").style.display = "none";
            document.getElementById("logout-modal").style.display = "none";
            document.getElementById("settings-modal").style.display = "none";
            document.getElementById("notification-modal").style.display = "none";
            document.getElementById("search-modal").style.display = "none";
            document.getElementById("edit-modal").style.display = "none";
            document.getElementById("ac-modal").style.display = "none";
            document.getElementById("lights-modal").style.display = "none";
            document.getElementById("heater-modal").style.display = "none";
            document.getElementById("fan-modal").style.display = "none";
            document.getElementById("task-timesup-modal").style.display = "none";
            document.getElementById("settings-changed-modal").style.display = "none";
            document.getElementById("modal-overlay").style.display = "none";
        }

        function togglePasswordVisibility() {
            const passwordField = document.getElementById("login-password");
            passwordField.type = passwordField.type === "password" ? "text" : "password";
        }

        function loadCredentials() {
            const storedUsername = localStorage.getItem("username");
            const storedPassword = localStorage.getItem("password");
            if (storedUsername) document.getElementById("login-username").value = storedUsername;
            if (storedPassword) document.getElementById("login-password").value = storedPassword;
        }

        function showLogoutModal() {
            if (!isLoggedIn) return showLoginModal();
            document.getElementById("logout-modal").style.display = "block";
            document.getElementById("modal-overlay").style.display = "block";
        }

        function logout() {
            isLoggedIn = false;
            localStorage.removeItem("username");
            localStorage.removeItem("password");
            document.getElementById("dashboard-page").classList.add("hidden");
            document.getElementById("front-page").classList.remove("hidden");
            closeModals();
            initFrontPage();
        }

        function showSettings() {
            if (!isLoggedIn) return showLoginModal();
            document.getElementById("settings-modal").style.display = "block";
            document.getElementById("modal-overlay").style.display = "block";
            loadSettings();
        }

        function loadSettings() {
            document.getElementById("username").value = localStorage.getItem("username") || "";
            document.getElementById("theme").value = localStorage.getItem("theme") || "smart-home";
            document.getElementById("temp-unit").value = localStorage.getItem("tempUnit") || "metric";
            document.getElementById("theme-color").value = localStorage.getItem("themeColor") || "#003366";
            document.getElementById("language").value = localStorage.getItem("language") || "en";
            document.getElementById("number-format").value = localStorage.getItem("numberFormat") || "en-US";
            document.getElementById("time-format").value = localStorage.getItem("timeFormat") || "12";
            document.getElementById("date-format").value = localStorage.getItem("dateFormat") || "MM/DD/YYYY";
            document.getElementById("time-zone").value = localStorage.getItem("timeZone") || "Asia/Kolkata";
            document.getElementById("first-day").value = localStorage.getItem("firstDay") || "Monday";
            document.getElementById("notification-sound").checked = localStorage.getItem("notificationSound") !== "false";
            document.getElementById("dark-mode").checked = localStorage.getItem("darkMode") === "true";
            applyThemeSettings();
            applyLanguage();
            applyTimeZone();
            const storedBackground = localStorage.getItem("backgroundImage");
            if (storedBackground) {
                document.body.style.background = `url(${storedBackground}) no-repeat center center fixed`;
                document.body.style.backgroundSize = "cover";
                document.querySelectorAll(".modal").forEach(modal => {
                    modal.style.background = `rgba(255, 255, 255, 0.9) url(${storedBackground}) no-repeat center center fixed`;
                    modal.style.backgroundSize = "cover";
                });
            }
        }

        function applyThemeSettings() {
            const theme = localStorage.getItem("theme") || "smart-home";
            const themeColor = localStorage.getItem("themeColor") || "#003366";
            const darkMode = localStorage.getItem("darkMode") === "true";
            document.body.classList.remove("energy-theme", "dark-mode");
            if (theme === "energy") document.body.classList.add("energy-theme");
            if (darkMode) document.body.classList.add("dark-mode");
            document.querySelector(".ha-sidebar").style.backgroundColor = themeColor;
        }

        function applyLanguage() {
            language = document.getElementById("language").value || "en";
            switch (language) {
                case "en":
                    setEnglish();
                    break;
                case "es":
                    setSpanish();
                    break;
                case "fr":
                    setFrench();
                    break;
                case "de":
                    setGerman();
                    break;
                case "ta":
                    setTamil();
                    break;
            }
            fetchWeatherAndForecast();
            updateTime();
        }

        function setEnglish() {
            document.getElementById("front-title").textContent = "Smart Home Dashboard";
            document.getElementById("login-title").textContent = "Login";
            document.getElementById("logout-title").textContent = "Are you sure you want to logout?";
            document.getElementById("settings-title").textContent = "User Settings";
            document.getElementById("notifications-title").textContent = "Notifications";
            document.getElementById("search-title").textContent = "Search Items";
            document.getElementById("edit-title").textContent = "Edit Items";
            document.getElementById("sidebar-logo").textContent = "Smart Home Assistant";
            document.getElementById("overview-link").textContent = "Overview";
            document.getElementById("energy-link").textContent = "Energy";
            document.getElementById("settings-link").textContent = "Settings";
            document.getElementById("notifications-link").textContent = "Notifications";
            document.getElementById("logout-link").textContent = "Logout";
            document.getElementById("dashboard-title").textContent = "Smart Home Dashboard";
            document.getElementById("weather-title").textContent = "Current Weather";
            document.getElementById("forecast-title").textContent = "7-Day Weather Forecast";
            document.getElementById("devices-title").textContent = "Device Control";
            document.getElementById("thermostat-title").textContent = "Thermostat";
            document.getElementById("lighting-title").textContent = "Home Lighting";
            document.getElementById("energy-title").textContent = "Energy Consumption";
            document.getElementById("tasks-title").textContent = "Task Reminder";
            document.getElementById("security-title").textContent = "Security";
        }

        function setSpanish() {
            document.getElementById("front-title").textContent = "Tablero de Hogar Inteligente";
            document.getElementById("login-title").textContent = "Iniciar sesi√≥n";
            document.getElementById("logout-title").textContent = "¬øEst√°s seguro de que quieres cerrar sesi√≥n?";
            document.getElementById("settings-title").textContent = "Configuraciones de usuario";
            document.getElementById("notifications-title").textContent = "Notificaciones";
            document.getElementById("search-title").textContent = "Buscar elementos";
            document.getElementById("edit-title").textContent = "Editar elementos";
            document.getElementById("sidebar-logo").textContent = "Asistente de Hogar Inteligente";
            document.getElementById("overview-link").textContent = "Visi√≥n general";
            document.getElementById("energy-link").textContent = "Energ√≠a";
            document.getElementById("settings-link").textContent = "Configuraciones";
            document.getElementById("notifications-link").textContent = "Notificaciones";
            document.getElementById("logout-link").textContent = "Cerrar sesi√≥n";
            document.getElementById("dashboard-title").textContent = "Tablero de Hogar Inteligente";
            document.getElementById("weather-title").textContent = "Clima actual";
            document.getElementById("forecast-title").textContent = "Pron√≥stico del tiempo a 7 d√≠as";
            document.getElementById("devices-title").textContent = "Control de dispositivos";
            document.getElementById("thermostat-title").textContent = "Termostato";
            document.getElementById("lighting-title").textContent = "Iluminaci√≥n del hogar";
            document.getElementById("energy-title").textContent = "Consumo de energ√≠a";
            document.getElementById("tasks-title").textContent = "Recordatorio de tareas";
            document.getElementById("security-title").textContent = "Seguridad";
        }

        function setFrench() {
            document.getElementById("front-title").textContent = "Tableau de Bord Maison Intelligente";
            document.getElementById("login-title").textContent = "Connexion";
            document.getElementById("logout-title").textContent = "√ätes-vous s√ªr de vouloir vous d√©connecter ?";
            document.getElementById("settings-title").textContent = "Param√®tres utilisateur";
            document.getElementById("notifications-title").textContent = "Notifications";
            document.getElementById("search-title").textContent = "Rechercher des √©l√©ments";
            document.getElementById("edit-title").textContent = "Modifier les √©l√©ments";
            document.getElementById("sidebar-logo").textContent = "Assistant Maison Intelligente";
            document.getElementById("overview-link").textContent = "Aper√ßu";
            document.getElementById("energy-link").textContent = "√ânergie";
            document.getElementById("settings-link").textContent = "Param√®tres";
            document.getElementById("notifications-link").textContent = "Notifications";
            document.getElementById("logout-link").textContent = "D√©connexion";
            document.getElementById("dashboard-title").textContent = "Tableau de Bord Maison Intelligente";
            document.getElementById("weather-title").textContent = "M√©t√©o actuelle";
            document.getElementById("forecast-title").textContent = "Pr√©visions m√©t√©o sur 7 jours";
            document.getElementById("devices-title").textContent = "Contr√¥le des appareils";
            document.getElementById("thermostat-title").textContent = "Thermostat";
            document.getElementById("lighting-title").textContent = "√âclairage domestique";
            document.getElementById("energy-title").textContent = "Consommation d'√©nergie";
            document.getElementById("tasks-title").textContent = "Rappel de t√¢ches";
            document.getElementById("security-title").textContent = "S√©curit√©";
        }

        function setGerman() {
            document.getElementById("front-title").textContent = "Smart Home Dashboard";
            document.getElementById("login-title").textContent = "Anmelden";
            document.getElementById("logout-title").textContent = "M√∂chten Sie sich wirklich abmelden?";
            document.getElementById("settings-title").textContent = "Benutzereinstellungen";
            document.getElementById("notifications-title").textContent = "Benachrichtigungen";
            document.getElementById("search-title").textContent = "Elemente suchen";
            document.getElementById("edit-title").textContent = "Elemente bearbeiten";
            document.getElementById("sidebar-logo").textContent = "Smart Home Assistent";
            document.getElementById("overview-link").textContent = "√úbersicht";
            document.getElementById("energy-link").textContent = "Energie";
            document.getElementById("settings-link").textContent = "Einstellungen";
            document.getElementById("notifications-link").textContent = "Benachrichtigungen";
            document.getElementById("logout-link").textContent = "Abmelden";
            document.getElementById("dashboard-title").textContent = "Smart Home Dashboard";
            document.getElementById("weather-title").textContent = "Aktuelles Wetter";
            document.getElementById("forecast-title").textContent = "7-Tage-Wettervorhersage";
            document.getElementById("devices-title").textContent = "Ger√§testeuerung";
            document.getElementById("thermostat-title").textContent = "Thermostat";
            document.getElementById("lighting-title").textContent = "Hausbeleuchtung";
            document.getElementById("energy-title").textContent = "Energieverbrauch";
            document.getElementById("tasks-title").textContent = "Aufgabenerinnerung";
            document.getElementById("security-title").textContent = "Sicherheit";
        }

        function setTamil() {
            document.getElementById("front-title").textContent = "‡Æ∏‡Øç‡ÆÆ‡Ææ‡Æ∞‡Øç‡Æü‡Øç ‡Æπ‡Øã‡ÆÆ‡Øç ‡Æü‡Ææ‡Æ∑‡Øç‡Æ™‡Øã‡Æ∞‡Øç‡Æü‡ØÅ";
            document.getElementById("login-title").textContent = "‡Æâ‡Æ≥‡Øç‡Æ®‡ØÅ‡Æ¥‡Øà‡Æµ‡ØÅ";
            document.getElementById("logout-title").textContent = "‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ®‡Æø‡Æö‡Øç‡Æö‡ÆØ‡ÆÆ‡Ææ‡Æï ‡Æµ‡ØÜ‡Æ≥‡Æø‡ÆØ‡Øá‡Æ± ‡Æµ‡Æø‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡ØÅ‡Æï‡Æø‡Æ±‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Ææ?";
            document.getElementById("settings-title").textContent = "‡Æ™‡ÆØ‡Æ©‡Æ∞‡Øç ‡ÆÖ‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç";
            document.getElementById("notifications-title").textContent = "‡ÆÖ‡Æ±‡Æø‡Æµ‡Æø‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç";
            document.getElementById("search-title").textContent = "‡Æ™‡Øä‡Æ∞‡ØÅ‡Æü‡Øç‡Æï‡Æ≥‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æü‡ØÅ";
            document.getElementById("edit-title").textContent = "‡Æ™‡Øä‡Æ∞‡ØÅ‡Æü‡Øç‡Æï‡Æ≥‡Øà‡Æ§‡Øç ‡Æ§‡Æø‡Æ∞‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ";
            document.getElementById("sidebar-logo").textContent = "‡Æ∏‡Øç‡ÆÆ‡Ææ‡Æ∞‡Øç‡Æü‡Øç ‡Æπ‡Øã‡ÆÆ‡Øç ‡Æâ‡Æ§‡Æµ‡Æø‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç";
            document.getElementById("overview-link").textContent = "‡ÆÆ‡Øá‡Æ≤‡Øã‡Æü‡Øç‡Æü‡ÆÆ‡Øç";
            document.getElementById("energy-link").textContent = "‡ÆÜ‡Æ±‡Øç‡Æ±‡Æ≤‡Øç";
            document.getElementById("settings-link").textContent = "‡ÆÖ‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç";
            document.getElementById("notifications-link").textContent = "‡ÆÖ‡Æ±‡Æø‡Æµ‡Æø‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç";
            document.getElementById("logout-link").textContent = "‡Æµ‡ØÜ‡Æ≥‡Æø‡ÆØ‡Øá‡Æ±‡ØÅ";
            document.getElementById("dashboard-title").textContent = "‡Æ∏‡Øç‡ÆÆ‡Ææ‡Æ∞‡Øç‡Æü‡Øç ‡Æπ‡Øã‡ÆÆ‡Øç ‡Æü‡Ææ‡Æ∑‡Øç‡Æ™‡Øã‡Æ∞‡Øç‡Æü‡ØÅ";
            document.getElementById("weather-title").textContent = "‡Æ§‡Æ±‡Øç‡Æ™‡Øã‡Æ§‡Øà‡ÆØ ‡Æµ‡Ææ‡Æ©‡Æø‡Æ≤‡Øà";
            document.getElementById("forecast-title").textContent = "7 ‡Æ®‡Ææ‡Æ≥‡Øç ‡Æµ‡Ææ‡Æ©‡Æø‡Æ≤‡Øà ‡ÆÆ‡ØÅ‡Æ©‡Øç‡Æ©‡Æ±‡Æø‡Æµ‡Æø‡Æ™‡Øç‡Æ™‡ØÅ";
            document.getElementBy("devices-title").textContent = "‡Æö‡Ææ‡Æ§‡Æ© ‡Æï‡Æü‡Øç‡Æü‡ØÅ‡Æ™‡Øç‡Æ™‡Ææ‡Æü‡ØÅ";
            document.getElementById("thermostat-title").textContent = "‡Æµ‡ØÜ‡Æ™‡Øç‡Æ™‡Æ®‡Æø‡Æ≤‡Øà ‡Æï‡Æü‡Øç‡Æü‡ØÅ‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æø";
            document.getElementById("lighting-title").textContent = "‡Æµ‡ØÄ‡Æü‡Øç‡Æü‡ØÅ ‡Æµ‡Æø‡Æ≥‡Æï‡Øç‡Æï‡ØÅ‡Æï‡Æ≥‡Øç";
            document.getElementById("energy-title").textContent = "‡ÆÜ‡Æ±‡Øç‡Æ±‡Æ≤‡Øç ‡Æ™‡ÆØ‡Æ©‡Øç‡Æ™‡Ææ‡Æü‡ØÅ";
            document.getElementById("tasks-title").textContent = "‡Æ™‡Æ£‡Æø ‡Æ®‡Æø‡Æ©‡Øà‡Æµ‡ØÇ‡Æü‡Øç‡Æü‡Æ≤‡Øç";
            document.getElementById("security-title").textContent = "‡Æ™‡Ææ‡Æ§‡ØÅ‡Æï‡Ææ‡Æ™‡Øç‡Æ™‡ØÅ";
        }

        function applyTimeZone() {
            timeZone = document.getElementById("time-zone").value;
            switch (timeZone) {
                case "UTC":
                    setUTC();
                    break;
                case "America/New_York":
                    setEasternTime();
                    break;
                case "Europe/London":
                    setGMT();
                    break;
                case "Asia/Tokyo":
                    setJST();
                    break;
                case "Asia/Kolkata":
                    setIST();
                    break;
            }
            updateTime();
        }

        function setUTC() {
            timeZone = "UTC";
        }

        function setEasternTime() {
            timeZone = "America/New_York";
        }

        function setGMT() {
            timeZone = "Europe/London";
        }

        function setJST() {
            timeZone = "Asia/Tokyo";
        }

        function setIST() {
            timeZone = "Asia/Kolkata";
        }

        function closeModal() {
            document.getElementById("settings-modal").style.display = "none";
            document.getElementById("modal-overlay").style.display = "none";
        }

        function closeSettingsChangedModal() {
            document.getElementById("settings-changed-modal").style.display = "none";
            document.getElementById("modal-overlay").style.display = "none";
        }
    </script>
</body>
</html>